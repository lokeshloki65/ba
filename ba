...........
AIM

Provide examples that: update rows, export/import table, and demonstrate SORT BY / DISTRIBUTE BY / CLUSTER BY behaviour on an employee table.

ALGORITHM (one flow — stepwise)

Create a table (transactional ORC + bucketing) so UPDATE works.

Insert sample rows.

UPDATE target row(s) (or alternate: INSERT OVERWRITE with CASE if no ACID).

EXPORT table to HDFS path (backup).

IMPORT into a new table name on same cluster.

Run example queries to show SORT BY, DISTRIBUTE BY, CLUSTER BY and capture results.

Verify outputs and summarise results.

PROGRAM (single HiveQL script — paste to Hive shell)

/* --- Prereq: hive configs allow ACID (for UPDATE). If not, see note below. --- */

-- 1) Create transactional table (for UPDATE)
CREATE TABLE IF NOT EXISTS employee(
  id INT,
  name STRING,
  dept STRING,
  salary INT
)
CLUSTERED BY (id) INTO 2 BUCKETS
STORED AS ORC
TBLPROPERTIES ("transactional"="true");

-- 2) Insert sample data
INSERT INTO employee VALUES
(1,'Ravi','Sales',30000),
(2,'Anita','HR',35000),
(3,'Kumar','Sales',32000),
(4,'Meena','IT',40000),
(5,'Sita','HR',36000);

-- 3) UPDATE example (give Kumar a raise)
UPDATE employee SET salary = 38000 WHERE id = 3;

-- 4) EXPORT table to HDFS
EXPORT TABLE employee TO 'hdfs:///user/youruser/exports/employee_exp';

-- 5) IMPORT into new table (create target like original first)
CREATE TABLE IF NOT EXISTS employee_imported LIKE employee;
IMPORT TABLE employee_imported FROM 'hdfs:///user/youruser/exports/employee_exp';

-- 6a) SORT BY (sort within reducer(s))
SELECT id, name, dept, salary FROM employee SORT BY salary;

-- 6b) DISTRIBUTE BY (send by dept; no sorting guaranteed)
SELECT id, name, dept, salary FROM employee DISTRIBUTE BY dept;

-- 6c) CLUSTER BY (distribute by + sort within reducer by dept)
SELECT id, name, dept, salary FROM employee CLUSTER BY dept;











---------------------------------------------------------------------------------------

EXPECTED OUTPUTS (sample prints)

After initial INSERT (before update) — SELECT * FROM employee;

1  Ravi   Sales  30000
2  Anita  HR     35000
3  Kumar  Sales  32000
4  Meena  IT     40000
5  Sita   HR     36000


After UPDATE id=3 -> 38000 — SELECT id,name,salary FROM employee ORDER BY id;

1  Ravi   30000
2  Anita  35000
3  Kumar  38000
4  Meena  40000
5  Sita   36000


EXPORT command → CLI message:

Exported successfully to hdfs:///user/youruser/exports/employee_exp


After IMPORT — SELECT * FROM employee_imported ORDER BY id;

1  Ravi   Sales  30000
2  Anita  HR     35000
3  Kumar  Sales  38000   -- updated value included if exported after update
4  Meena  IT     40000
5  Sita   HR     36000


SELECT ... SORT BY salary; (if single reducer — global sort; otherwise sorted per reducer)
Possible global-sorted output (ascending):

1 Ravi  Sales  30000
2 Anita HR     35000
5 Sita  HR     36000
3 Kumar Sales  38000
4 Meena IT     40000


SELECT ... DISTRIBUTE BY dept; (order may vary; rows with same dept go to same reducer)
Example grouping (order inside groups not guaranteed):

2 Anita HR 35000
5 Sita  HR 36000
1 Ravi  Sales 30000
3 Kumar Sales 38000
4 Meena IT 40000


SELECT ... CLUSTER BY dept; (same dept grouped & sorted inside reducer):

2 Anita HR 35000
5 Sita  HR 36000
4 Meena IT 40000
1 Ravi  Sales 30000
3 Kumar Sales 38000



--------------------------------------------------------------
